generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id      Int       @id @default(autoincrement())
  address String    @unique
  balance Int       @default(0)
  tasks   Task[]
  funding Funding[]
}

model Task {
  id           Int          @id @default(autoincrement())
  title        String       @default("Select the most clickable thumbnail")
  user_id      Int
  signature    String?
  amount       String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  status       String       @default("CREATED")
  budget       Int
  fundedAmount Int          @default(0)
  options      Option[]
  submissions  Submission[]
  user         User         @relation(fields: [user_id], references: [id])
  funding      Funding[]
}

model Option {
  id          Int          @id @default(autoincrement())
  ipfs_cid    String?
  ipfs_uri    String?
  gateway_url String?
  image_url   String?
  option_id   Int?
  task_id     Int
  task        Task         @relation(fields: [task_id], references: [id])
  submissions Submission[]
}

model Worker {
  id             Int          @id @default(autoincrement())
  address        String       @unique
  pending_amount Int
  locked_amount  Int
  wallet_address String?      @unique
  payouts        Payout[]
  submissions    Submission[]
}

model Submission {
  id        Int      @id @default(autoincrement())
  worker_id Int
  option_id Int
  task_id   Int
  createdAt DateTime @default(now())
  option    Option   @relation(fields: [option_id], references: [id])
  task      Task     @relation(fields: [task_id], references: [id])
  worker    Worker   @relation(fields: [worker_id], references: [id])
}

model Payout {
  id        Int      @id @default(autoincrement())
  workerId  Int
  amount    Int
  gasFee    Int
  netAmount Int
  status    String
  txRef     String?
  createdAt DateTime @default(now())
  worker    Worker   @relation(fields: [workerId], references: [id])
}

model Funding {
  id        Int      @id @default(autoincrement())
  user_id   Int
  task_id   Int?
  txHash    String?  @unique
  credits   Int
  source    String // BLOCKCHAIN | INTERNAL BALANCE
  createdAt DateTime @default(now())

  user User  @relation(fields: [user_id], references: [id])
  task Task? @relation(fields: [task_id], references: [id])
}
